{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/woodj/Desktop/christmas-list/src/app/list/%5BfamilyId%5D/AddGiftForm.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useCallback } from 'react'\nimport { createClient } from '@/lib/supabase'\n// import { useRouter } from 'next/navigation' // No longer needed\n\ninterface Member {\n  id: string;\n  name: string;\n}\n\ninterface AddGiftFormProps {\n  familyId: string;\n  currentUserId: string;\n  members: Member[];\n  onClose: () => void; // Add onClose prop\n  onGiftAdded: () => Promise<void>; // New prop to refresh family list\n}\n\n// Debounce function defined outside the component to be stable\nconst debounce = <Args extends unknown[]>(func: (...args: Args) => unknown, delay: number): ((...args: Args) => void) => {\n  let timeout: NodeJS.Timeout | null = null\n  return (...args: Args) => {\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n    timeout = setTimeout(() => {\n      func(...args)\n    }, delay)\n  }\n}\n\nexport default function AddGiftForm({ familyId, currentUserId, members, onClose, onGiftAdded }: AddGiftFormProps) {\n  const [newGiftDescription, setNewGiftDescription] = useState('')\n  const [newGiftNotes, setNewGiftNotes] = useState('')\n  const [newGiftPrice, setNewGiftPrice] = useState<string>('')\n  const [newProductUrl, setNewProductUrl] = useState('')\n  const [fetchedProductTitle, setFetchedProductTitle] = useState('')\n  const [fetchedProductImageUrl, setFetchedProductImageUrl] = useState('')\n  const [fetchedProductPrice, setFetchedProductPrice] = useState<string>('')\n  const [isFetchingMetadata, setIsFetchingMetadata] = useState(false)\n  const [selectedRecipientId, setSelectedRecipientId] = useState(currentUserId) // Default to current user\n  const [message, setMessage] = useState('')\n  const supabase = createClient()\n  // const router = useRouter() // No longer needed\n\n  const fetchMetadata = useCallback(async (url: string) => {\n    if (!url || !url.startsWith('http')) {\n      setFetchedProductTitle('')\n      setFetchedProductImageUrl('')\n      setFetchedProductPrice('')\n      return\n    }\n\n    setIsFetchingMetadata(true)\n    try {\n      const res = await fetch('/api/gifts/fetch-metadata', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ url }),\n      })\n      const data = await res.json()\n\n      if (res.ok) {\n        setFetchedProductTitle(data.title || '')\n        setFetchedProductImageUrl(data.imageUrl || '')\n        setFetchedProductPrice(data.price ? data.price.toFixed(2) : '')\n        // If price is fetched, pre-fill the gift price field\n        if (data.price) setNewGiftPrice(data.price.toFixed(2))\n      } else {\n        setMessage(`Failed to fetch metadata: ${data.error}`)\n        setFetchedProductTitle('')\n        setFetchedProductImageUrl('')\n        setFetchedProductPrice('')\n      }\n    } catch (error: unknown) {\n      let errorMessage = 'Error fetching metadata';\n      if (error instanceof Error) {\n        errorMessage = error.message;\n      } else if (typeof error === 'string') {\n        errorMessage = error;\n      }\n      setMessage(`Error fetching metadata: ${errorMessage}`)\n      setFetchedProductTitle('')\n      setFetchedProductImageUrl('')\n      setFetchedProductPrice('')\n    } finally {\n      setIsFetchingMetadata(false)\n    }\n  }, [])\n\n  const debouncedFetchMetadata = useCallback(debounce(fetchMetadata, 700), [fetchMetadata])\n\n  const handleAddGift = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setMessage('')\n\n    if (!newGiftDescription && !fetchedProductTitle) {\n      setMessage('Gift description or fetched product title is required.')\n      return\n    }\n\n    if (!selectedRecipientId) {\n      setMessage('Please select a recipient.')\n      return\n    }\n\n    // Get the current max order_index for the list\n    const { data: maxOrderData, error: _maxOrderError } = await supabase\n      .from('items')\n      .select('order_index')\n      .eq('list_id', familyId)\n      .order('order_index', { ascending: false })\n      .limit(1)\n      .single()\n\n    const nextOrderIndex = maxOrderData ? maxOrderData.order_index + 1 : 0;\n\n    const { error } = await supabase\n      .from('items')\n      .insert([{\n        list_id: familyId,\n        user_id: selectedRecipientId,\n        name: newGiftDescription || fetchedProductTitle, // Use fetched title if description is empty\n        notes: newGiftNotes || null,\n        price: newGiftPrice ? parseFloat(newGiftPrice) : (fetchedProductPrice ? parseFloat(fetchedProductPrice) : null),\n        order_index: nextOrderIndex,\n        product_url: newProductUrl || null,\n        product_title: fetchedProductTitle || null,\n        product_image_url: fetchedProductImageUrl || null,\n        product_price: fetchedProductPrice ? parseFloat(fetchedProductPrice) : null,\n      }])\n\n    if (error) {\n      setMessage(`Failed to add gift: ${error.message}`)\n    } else {\n      setMessage(`Gift \"${newGiftDescription || fetchedProductTitle}\" added successfully!`)\n      setNewGiftDescription('')\n      setNewGiftNotes('')\n      setNewGiftPrice('')\n      setNewProductUrl('')\n      setFetchedProductTitle('')\n      setFetchedProductImageUrl('')\n      setFetchedProductPrice('')\n      await onGiftAdded() // Refresh the current page to show the new gift\n      onClose() // Close the modal after adding gift\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-md relative\">\n        <button\n          onClick={onClose}\n          className=\"absolute top-3 right-3 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n          aria-label=\"Close\"\n        >\n          &times;\n        </button>\n        <h3 className=\"text-xl font-semibold mb-3\">Add a Gift</h3>\n        {message && <p className=\"text-red-500 mb-3\">{message}</p>}\n        <form onSubmit={handleAddGift} className=\"space-y-3\">\n          <div>\n            <label htmlFor=\"recipient\" className=\"block text-sm font-medium text-gray-300\">Recipient</label>\n            <select\n              id=\"recipient\"\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={selectedRecipientId}\n              onChange={(e) => setSelectedRecipientId(e.target.value)}\n              required\n            >\n              {members.map((member) => (\n                <option key={member.id} value={member.id}>\n                  {member.name} {member.id === currentUserId ? '(You)' : ''}\n                </option>\n              ))}\n            </select>\n          </div>\n          <div>\n            <label htmlFor=\"product-url\" className=\"block text-sm font-medium text-gray-300\">\n              Product URL (Optional)\n            </label>\n            <input\n              type=\"url\"\n              id=\"product-url\"\n              placeholder=\"e.g., https://example.com/product\"\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newProductUrl}\n              onChange={(e) => {\n                setNewProductUrl(e.target.value)\n                debouncedFetchMetadata(e.target.value)\n              }}\n              onBlur={(e) => fetchMetadata(e.target.value)}\n            />\n            {isFetchingMetadata && <p className=\"text-sm text-gray-500 mt-1\">Fetching product details...</p>}\n            {fetchedProductTitle && (\n              <div className=\"mt-2 p-2 border border-gray-200 dark:border-gray-700 rounded-md flex items-center space-x-3\">\n                {fetchedProductImageUrl && (\n                  // eslint-disable-next-line @next/next/no-img-element\n                  <img src={fetchedProductImageUrl} alt={fetchedProductTitle} className=\"w-16 h-16 object-cover rounded-md\" />\n                )}\n                <div>\n                  <p className=\"font-semibold text-gray-700 dark:text-gray-200\">{fetchedProductTitle}</p>\n                  {fetchedProductPrice && <p className=\"text-sm text-gray-600 dark:text-gray-300\">${fetchedProductPrice}</p>}\n                </div>\n              </div>\n            )}\n          </div>\n          <div>\n            <label htmlFor=\"gift-desc\" className=\"block text-sm font-medium text-gray-300\">\n              Gift Description (or use fetched title)\n            </label>\n            <input\n              type=\"text\"\n              id=\"gift-desc\"\n              placeholder=\"Gift description\"\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newGiftDescription}\n              onChange={(e) => setNewGiftDescription(e.target.value)}\n              required={!fetchedProductTitle} // Required only if no title is fetched\n            />\n          </div>\n          <div>\n            <label htmlFor=\"gift-notes\" className=\"block text-sm font-medium text-gray-300\">\n              Notes (Optional)\n            </label>\n            <textarea\n              id=\"gift-notes\"\n              placeholder=\"e.g., Size M, color blue, link to product\"\n              rows={3}\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newGiftNotes}\n              onChange={(e) => setNewGiftNotes(e.target.value)}\n            />\n          </div>\n          <div>\n            <label htmlFor=\"gift-price\" className=\"block text-sm font-medium text-gray-300\">\n              Price (Optional)\n            </label>\n            <input\n              type=\"number\"\n              id=\"gift-price\"\n              placeholder=\"e.g., 25.99\"\n              step=\"0.01\"\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newGiftPrice}\n              onChange={(e) => setNewGiftPrice(e.target.value)}\n            />\n          </div>\n          <button\n            type=\"submit\"\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm\"\n          >\n            Add Gift\n          </button>\n        </form>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 417, "column": 0}, "map": {"version":3,"sources":["file:///Users/woodj/Desktop/christmas-list/src/app/list/%5BfamilyId%5D/ClaimUnclaimButtons.tsx"],"sourcesContent":["'use client'\n\nimport { useRouter } from 'next/navigation'\nimport { useState } from 'react'\nimport Image from 'next/image'\n\ninterface Gift {\n  id: string;\n  description: string;\n  is_purchased: boolean;\n  purchased_by?: string;\n  user_id: string;\n}\n\ninterface ClaimUnclaimButtonsProps {\n  gift: Gift;\n  userId: string;\n  refreshFamily: () => Promise<void>;\n}\n\nexport default function ClaimUnclaimButtons({ gift, userId, refreshFamily }: ClaimUnclaimButtonsProps) {\n  const [message, setMessage] = useState('')\n  // const router = useRouter() // No longer needed\n\n  const handleClaimGift = async () => {\n    setMessage('')\n    const res = await fetch(`/api/gifts/${gift.id}/claim`, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ claimedByUserId: userId }),\n    })\n\n    if (res.ok) {\n      setMessage('Gift claimed successfully!')\n      refreshFamily() // Use refreshFamily instead of router.refresh()\n    } else {\n      const errorText = await res.text()\n      setMessage(`Failed to claim gift: ${errorText}`)\n    }\n  }\n\n  const handleUnclaimGift = async () => {\n    setMessage('')\n    const res = await fetch(`/api/gifts/${gift.id}/unclaim`, {\n      method: 'PATCH', // Changed to PATCH as per API route\n      headers: { 'Content-Type': 'application/json' },\n    })\n\n    if (res.ok) {\n      setMessage('Gift unclaimed successfully!')\n      refreshFamily() // Use refreshFamily instead of router.refresh()\n    } else {\n      const errorText = await res.text()\n      setMessage(`Failed to unclaim gift: ${errorText}`)\n    }\n  }\n\n  return (\n    <div>\n      {message && <p className=\"text-red-500 text-sm mb-2\">{message}</p>}\n      {!gift.is_purchased && (\n        <button\n          onClick={handleClaimGift}\n          className=\"p-2 text-purple-600 rounded-full hover:bg-purple-100 transition-colors flex items-center justify-center\"\n          aria-label=\"Claim Gift\"\n        >\n          <Image src=\"/cart.svg\" alt=\"Claim Gift\" width={24} height={24} />\n        </button>\n      )}\n      {gift.is_purchased && gift.purchased_by === userId && (\n        <button\n          onClick={handleUnclaimGift}\n          className=\"p-2 text-yellow-600 rounded-full hover:bg-yellow-100 transition-colors flex items-center justify-center\"\n          aria-label=\"Unclaim Gift\"\n        >\n          <Image src=\"/cart.svg\" alt=\"Unclaim Gift\" width={24} height={24} />\n        </button>\n      )}\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAGA;AACA;AAJA;;;;AAoBe,SAAS,oBAAoB,EAAE,IAAI,EAAE,MAAM,EAAE,aAAa,EAA4B;IACnG,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,iDAAiD;IAEjD,MAAM,kBAAkB;QACtB,WAAW;QACX,MAAM,MAAM,MAAM,MAAM,CAAC,WAAW,EAAE,KAAK,EAAE,CAAC,MAAM,CAAC,EAAE;YACrD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE,iBAAiB;YAAO;QACjD;QAEA,IAAI,IAAI,EAAE,EAAE;YACV,WAAW;YACX,iBAAgB,gDAAgD;QAClE,OAAO;YACL,MAAM,YAAY,MAAM,IAAI,IAAI;YAChC,WAAW,CAAC,sBAAsB,EAAE,WAAW;QACjD;IACF;IAEA,MAAM,oBAAoB;QACxB,WAAW;QACX,MAAM,MAAM,MAAM,MAAM,CAAC,WAAW,EAAE,KAAK,EAAE,CAAC,QAAQ,CAAC,EAAE;YACvD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;QAEA,IAAI,IAAI,EAAE,EAAE;YACV,WAAW;YACX,iBAAgB,gDAAgD;QAClE,OAAO;YACL,MAAM,YAAY,MAAM,IAAI,IAAI;YAChC,WAAW,CAAC,wBAAwB,EAAE,WAAW;QACnD;IACF;IAEA,qBACE,8OAAC;;YACE,yBAAW,8OAAC;gBAAE,WAAU;0BAA6B;;;;;;YACrD,CAAC,KAAK,YAAY,kBACjB,8OAAC;gBACC,SAAS;gBACT,WAAU;gBACV,cAAW;0BAEX,cAAA,8OAAC,wIAAK;oBAAC,KAAI;oBAAY,KAAI;oBAAa,OAAO;oBAAI,QAAQ;;;;;;;;;;;YAG9D,KAAK,YAAY,IAAI,KAAK,YAAY,KAAK,wBAC1C,8OAAC;gBACC,SAAS;gBACT,WAAU;gBACV,cAAW;0BAEX,cAAA,8OAAC,wIAAK;oBAAC,KAAI;oBAAY,KAAI;oBAAe,OAAO;oBAAI,QAAQ;;;;;;;;;;;;;;;;;AAKvE","debugId":null}},
    {"offset": {"line": 525, "column": 0}, "map": {"version":3,"sources":["file:///Users/woodj/Desktop/christmas-list/src/app/list/%5BfamilyId%5D/AddMemberForm.tsx"],"sourcesContent":["import { createClient } from '@/lib/supabase'\nimport { useState } from 'react'\n// import { useRouter } from 'next/navigation' // No longer needed\n\ninterface AddMemberFormProps {\n  familyId: string;\n  currentUserId: string;\n  members: { id: string; name: string }[];\n  onClose: () => void; // Add onClose prop\n  onMemberAdded: () => Promise<void>; // New prop to refresh family list\n}\n\nexport default function AddMemberForm({ familyId, currentUserId, members, onClose, onMemberAdded }: AddMemberFormProps) {\n  const [newMemberName, setNewMemberName] = useState('')\n  const [newMemberEmail, setNewMemberEmail] = useState('') // Assuming email for finding user ID\n  const [message, setMessage] = useState('')\n  const supabase = createClient()\n  // const router = useRouter() // No longer needed\n\n  const handleAddMember = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setMessage('')\n\n    console.log(\"Attempting to add member:\", { newMemberName, newMemberEmail, familyId, currentUserId });\n\n    if (!newMemberName || !newMemberEmail) {\n      setMessage('Member name and email are required.')\n      return\n    }\n\n    // First, check if the current user is part of this family list\n    const isCurrentUserMember = members.some(member => member.id === currentUserId);\n    if (!isCurrentUserMember) {\n      setMessage('You must be a member of this list to add new members.');\n      return;\n    }\n\n    try {\n      const res = await fetch(`/api/lists/${familyId}/members`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ memberName: newMemberName, memberEmail: newMemberEmail }),\n      });\n\n      console.log(\"API response status:\", res.status);\n      const data = await res.json();\n      console.log(\"API response data:\", data);\n\n      if (res.ok) {\n        setMessage(data.message);\n        setNewMemberName('');\n        setNewMemberEmail('');\n        await onMemberAdded(); // Refresh the current page to show the new member in the dropdowns\n        onClose(); // Close the modal after adding member\n      } else {\n        setMessage(`Failed to add member: ${data.error}`);\n      }\n    } catch (error: unknown) {\n      let errorMessage = 'Error adding member';\n      if (error instanceof Error) {\n        errorMessage = error.message;\n      } else if (typeof error === 'string') {\n        errorMessage = error;\n      }\n      setMessage(`Error adding member: ${errorMessage}`);\n      console.error(\"Error during add member fetch:\", error);\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-md relative\">\n        <button\n          onClick={onClose}\n          className=\"absolute top-3 right-3 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n          aria-label=\"Close\"\n        >\n          &times;\n        </button>\n        <h3 className=\"text-2xl font-semibold mb-4\">Add New Family Member</h3>\n        {message && <p className=\"text-red-500 mb-4\">{message}</p>}\n        <form onSubmit={handleAddMember} className=\"space-y-4\">\n          <div>\n            <label htmlFor=\"newMemberName\" className=\"block text-sm font-medium text-gray-300\">Member Name</label>\n            <input\n              type=\"text\"\n              id=\"newMemberName\"\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newMemberName}\n              onChange={(e) => setNewMemberName(e.target.value)}\n              required\n            />\n          </div>\n          <div>\n            <label htmlFor=\"newMemberEmail\" className=\"block text-sm font-medium text-gray-300\">Member Email</label>\n            <input\n              type=\"email\"\n              id=\"newMemberEmail\"\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newMemberEmail}\n              onChange={(e) => setNewMemberEmail(e.target.value)}\n              required\n            />\n          </div>\n          <button\n            type=\"submit\"\n            className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm\"\n          >\n            Add Member\n          </button>\n        </form>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAWe,SAAS,cAAc,EAAE,QAAQ,EAAE,aAAa,EAAE,OAAO,EAAE,OAAO,EAAE,aAAa,EAAsB;IACpH,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAC;IACnD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAC,IAAI,qCAAqC;;IAC9F,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,WAAW,IAAA,sIAAY;IAC7B,iDAAiD;IAEjD,MAAM,kBAAkB,OAAO;QAC7B,EAAE,cAAc;QAChB,WAAW;QAEX,QAAQ,GAAG,CAAC,6BAA6B;YAAE;YAAe;YAAgB;YAAU;QAAc;QAElG,IAAI,CAAC,iBAAiB,CAAC,gBAAgB;YACrC,WAAW;YACX;QACF;QAEA,+DAA+D;QAC/D,MAAM,sBAAsB,QAAQ,IAAI,CAAC,CAAA,SAAU,OAAO,EAAE,KAAK;QACjE,IAAI,CAAC,qBAAqB;YACxB,WAAW;YACX;QACF;QAEA,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,CAAC,WAAW,EAAE,SAAS,QAAQ,CAAC,EAAE;gBACxD,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,YAAY;oBAAe,aAAa;gBAAe;YAChF;YAEA,QAAQ,GAAG,CAAC,wBAAwB,IAAI,MAAM;YAC9C,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,QAAQ,GAAG,CAAC,sBAAsB;YAElC,IAAI,IAAI,EAAE,EAAE;gBACV,WAAW,KAAK,OAAO;gBACvB,iBAAiB;gBACjB,kBAAkB;gBAClB,MAAM,iBAAiB,mEAAmE;gBAC1F,WAAW,sCAAsC;YACnD,OAAO;gBACL,WAAW,CAAC,sBAAsB,EAAE,KAAK,KAAK,EAAE;YAClD;QACF,EAAE,OAAO,OAAgB;YACvB,IAAI,eAAe;YACnB,IAAI,iBAAiB,OAAO;gBAC1B,eAAe,MAAM,OAAO;YAC9B,OAAO,IAAI,OAAO,UAAU,UAAU;gBACpC,eAAe;YACjB;YACA,WAAW,CAAC,qBAAqB,EAAE,cAAc;YACjD,QAAQ,KAAK,CAAC,kCAAkC;QAClD;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBACC,SAAS;oBACT,WAAU;oBACV,cAAW;8BACZ;;;;;;8BAGD,8OAAC;oBAAG,WAAU;8BAA8B;;;;;;gBAC3C,yBAAW,8OAAC;oBAAE,WAAU;8BAAqB;;;;;;8BAC9C,8OAAC;oBAAK,UAAU;oBAAiB,WAAU;;sCACzC,8OAAC;;8CACC,8OAAC;oCAAM,SAAQ;oCAAgB,WAAU;8CAA0C;;;;;;8CACnF,8OAAC;oCACC,MAAK;oCACL,IAAG;oCACH,WAAU;oCACV,OAAO;oCACP,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;oCAChD,QAAQ;;;;;;;;;;;;sCAGZ,8OAAC;;8CACC,8OAAC;oCAAM,SAAQ;oCAAiB,WAAU;8CAA0C;;;;;;8CACpF,8OAAC;oCACC,MAAK;oCACL,IAAG;oCACH,WAAU;oCACV,OAAO;oCACP,UAAU,CAAC,IAAM,kBAAkB,EAAE,MAAM,CAAC,KAAK;oCACjD,QAAQ;;;;;;;;;;;;sCAGZ,8OAAC;4BACC,MAAK;4BACL,WAAU;sCACX;;;;;;;;;;;;;;;;;;;;;;;AAOX","debugId":null}},
    {"offset": {"line": 719, "column": 0}, "map": {"version":3,"sources":["file:///Users/woodj/Desktop/christmas-list/src/app/list/%5BfamilyId%5D/EditGiftForm.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useCallback } from 'react'\n\ninterface Gift {\n  id: string;\n  description: string;\n  notes?: string;\n  price?: number;\n  product_url?: string;\n  product_title?: string;\n  product_image_url?: string;\n  product_price?: number;\n}\n\ninterface EditGiftFormProps {\n  gift: Gift;\n  onClose: () => void;\n  onSave: () => Promise<void>; // Changed to Promise<void>\n}\n\nexport default function EditGiftForm({ gift, onClose, onSave }: EditGiftFormProps) {\n  const [newDescription, setNewDescription] = useState(gift.description)\n  const [newNotes, setNewNotes] = useState(gift.notes || '')\n  const [newPrice, setNewPrice] = useState<string>(gift.price?.toString() || '')\n  const [newProductUrl, setNewProductUrl] = useState(gift.product_url || '')\n  const [fetchedProductTitle, setFetchedProductTitle] = useState(gift.product_title || '')\n  const [fetchedProductImageUrl, setFetchedProductImageUrl] = useState(gift.product_image_url || '')\n  const [fetchedProductPrice, setFetchedProductPrice] = useState<string>(gift.product_price?.toString() || '')\n  const [isFetchingMetadata, setIsFetchingMetadata] = useState(false)\n  const [message, setMessage] = useState('')\n\n// Debounce function defined outside the component to be stable\nconst debounce = <Args extends unknown[]>(func: (...args: Args) => unknown, delay: number): ((...args: Args) => void) => {\n  let timeout: NodeJS.Timeout | null = null\n  return (...args: Args) => {\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n    timeout = setTimeout(() => {\n      func(...args)\n    }, delay)\n  }\n}\n\n  const fetchMetadata = useCallback(async (url: string) => {\n    if (!url || !url.startsWith('http')) {\n      setFetchedProductTitle('')\n      setFetchedProductImageUrl('')\n      setFetchedProductPrice('')\n      return\n    }\n\n    setIsFetchingMetadata(true)\n    try {\n      const res = await fetch('/api/gifts/fetch-metadata', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ url }),\n      })\n      const data = await res.json()\n\n      if (res.ok) {\n        setFetchedProductTitle(data.title || '')\n        setFetchedProductImageUrl(data.imageUrl || '')\n        setFetchedProductPrice(data.price ? data.price.toFixed(2) : '')\n        // If price is fetched, pre-fill the gift price field\n        if (data.price) setNewPrice(data.price.toFixed(2))\n      } else {\n        setMessage(`Failed to fetch metadata: ${data.error}`)\n        setFetchedProductTitle('')\n        setFetchedProductImageUrl('')\n        setFetchedProductPrice('')\n      }\n    } catch (error: unknown) {\n      let errorMessage = 'Error fetching metadata';\n      if (error instanceof Error) {\n        errorMessage = error.message;\n      } else if (typeof error === 'string') {\n        errorMessage = error;\n      }\n      setMessage(`Error fetching metadata: ${errorMessage}`)\n      setFetchedProductTitle('')\n      setFetchedProductImageUrl('')\n      setFetchedProductPrice('')\n    } finally {\n      setIsFetchingMetadata(false)\n    }\n  }, [])\n\n  const debouncedFetchMetadata = useCallback(debounce(fetchMetadata, 700), [fetchMetadata])\n\n  const handleSave = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setMessage('')\n\n    if (!newDescription) {\n      setMessage('Gift description cannot be empty.')\n      return\n    }\n\n    const res = await fetch(`/api/gifts/${gift.id}`, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        description: newDescription,\n        notes: newNotes,\n        price: newPrice ? parseFloat(newPrice) : null,\n        product_url: newProductUrl || null,\n        product_title: fetchedProductTitle || null,\n        product_image_url: fetchedProductImageUrl || null,\n        product_price: fetchedProductPrice ? parseFloat(fetchedProductPrice) : null,\n      }),\n    })\n\n    if (res.ok) {\n      setMessage('Gift updated successfully!')\n      await onSave() // Call onSave after successful update\n    } else {\n      const errorText = await res.text()\n      setMessage(`Failed to update gift: ${errorText}`)\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center\">\n      <div className=\"bg-white p-8 rounded-lg shadow-xl max-w-md w-full\">\n        <h2 className=\"text-2xl font-bold mb-4\">Edit Gift</h2>\n        {message && <p className=\"text-red-500 mb-4\">{message}</p>}\n        <form onSubmit={handleSave} className=\"space-y-4\">\n          <div>\n            <label htmlFor=\"gift-description\" className=\"block text-sm font-medium text-gray-300\">Gift Description</label>\n            <input\n              type=\"text\"\n              id=\"gift-description\"\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newDescription}\n              onChange={(e) => setNewDescription(e.target.value)}\n              required\n            />\n          </div>\n          <div>\n            <label htmlFor=\"product-url\" className=\"block text-sm font-medium text-gray-300\">\n              Product URL (Optional)\n            </label>\n            <input\n              type=\"url\"\n              id=\"product-url\"\n              placeholder=\"e.g., https://example.com/product\"\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newProductUrl}\n              onChange={(e) => {\n                setNewProductUrl(e.target.value)\n                debouncedFetchMetadata(e.target.value)\n              }}\n              onBlur={(e) => fetchMetadata(e.target.value)}\n            />\n            {isFetchingMetadata && <p className=\"text-sm text-gray-500 mt-1\">Fetching product details...</p>}\n            {fetchedProductTitle && (\n              <div className=\"mt-2 p-2 border border-gray-200 dark:border-gray-700 rounded-md flex items-center space-x-3\">\n                {fetchedProductImageUrl && (\n                  // eslint-disable-next-line @next/next/no-img-element\n                  <img src={fetchedProductImageUrl} alt={fetchedProductTitle} className=\"w-16 h-16 object-cover rounded-md\" />\n                )}\n                <div>\n                  <p className=\"font-semibold text-gray-700 dark:text-gray-200\">{fetchedProductTitle}</p>\n                  {fetchedProductPrice && <p className=\"text-sm text-gray-600 dark:text-gray-300\">${fetchedProductPrice}</p>}\n                </div>\n              </div>\n            )}\n          </div>\n          <div>\n            <label htmlFor=\"gift-notes\" className=\"block text-sm font-medium text-gray-300\">Notes (Optional)</label>\n            <textarea\n              id=\"gift-notes\"\n              placeholder=\"e.g., Size M, color blue, link to product\"\n              rows={3}\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newNotes}\n              onChange={(e) => setNewNotes(e.target.value)}\n            />\n          </div>\n          <div>\n            <label htmlFor=\"gift-price\" className=\"block text-sm font-medium text-gray-300\">Price (Optional)</label>\n            <input\n              type=\"number\"\n              id=\"gift-price\"\n              placeholder=\"e.g., 25.99\"\n              step=\"0.01\"\n              className=\"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              value={newPrice}\n              onChange={(e) => setNewPrice(e.target.value)}\n            />\n          </div>\n          <div className=\"flex justify-end space-x-2\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n            >\n              Save Changes\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1079, "column": 0}, "map": {"version":3,"sources":["file:///Users/woodj/Desktop/christmas-list/src/app/list/%5BfamilyId%5D/FamilyListClient.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { DragDropContext, Droppable, Draggable, DropResult } from '@hello-pangea/dnd'\nimport Link from 'next/link'\nimport Image from 'next/image' // Import Image component\nimport AddGiftForm from './AddGiftForm'\nimport ClaimUnclaimButtons from './ClaimUnclaimButtons'\nimport AddMemberForm from './AddMemberForm'\nimport EditGiftForm from './EditGiftForm' // New component for editing gifts\nimport QRCode from 'react-qr-code'\nimport { User } from '@supabase/supabase-js'\nimport ReactDOM from 'react-dom' // Import ReactDOM\n\ninterface Gift {\n  id: string;\n  description: string;\n  is_purchased: boolean;\n  purchased_by?: string;\n  user_id: string;\n  order_index?: number;\n  notes?: string; // Add notes\n  price?: number; // Add price\n  product_url?: string;\n  product_title?: string;\n  product_image_url?: string;\n  product_price?: number;\n}\n\ninterface Member {\n  id: string;\n  name: string;\n  gifts: Gift[];\n}\n\ninterface Family {\n  id: string;\n  name: string;\n  owner_id: string;\n  members: Member[];\n}\n\n// Utility function to format notes with clickable links\nconst formatNotesWithLinks = (notes?: string) => {\n  if (!notes) return null;\n  const urlRegex = /(https?:\\/\\/[^\\s]+)/g;\n  return notes.split(urlRegex).map((part, index) => {\n    if (part.match(urlRegex)) {\n      return (\n        <a key={index} href={part} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 hover:underline\">\n          {part}\n        </a>\n      );\n    }\n    return part;\n  });\n};\n\nexport default function FamilyListClient({ initialFamily, initialUser, familyId }: { initialFamily: Family, initialUser: User | null, familyId: string }) {\n  const [family, setFamily] = useState<Family>(initialFamily)\n  const [user] = useState<User | null>(initialUser)\n  const [editingGift, setEditingGift] = useState<Gift | null>(null)\n  const [sortKey, setSortKey] = useState<keyof Gift | 'order_index'>('order_index'); // Default sort by order_index\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc'); // Default sort order ascending\n  const [showQrModal, setShowQrModal] = useState(false)\n  const [showAddGiftModal, setShowAddGiftModal] = useState(false) // New state for AddGiftForm modal\n  const [showAddMemberModal, setShowAddMemberModal] = useState(false) // New state for AddMemberForm modal\n  const [inviteToken, setInviteToken] = useState<string | null>(null)\n  const [viewMode, setViewMode] = useState<'list' | 'grid'>('list') // New state for view mode\n  const [isDragging, setIsDragging] = useState(false); // New state to track dragging\n  const [sourceDroppableId, setSourceDroppableId] = useState<string | null>(null); // New state to track the source list of the dragged item\n  const [copyMessage, setCopyMessage] = useState(''); // New state for copy feedback\n  const [isFindingImages, setIsFindingImages] = useState(false);\n  const [findImagesMessage, setFindImagesMessage] = useState('');\n  const router = useRouter()\n  const [mounted, setMounted] = useState(false);\n  const [portalNode, setPortalNode] = useState<HTMLElement | null>(null);\n\n  const refreshFamily = async () => {\n    const res = await fetch(`/api/lists/${familyId}/details`);\n    if (res.ok) {\n      const updatedFamily = await res.json();\n      setFamily(updatedFamily);\n    } else {\n      console.error('Failed to refresh family data');\n      // Optionally, handle error more gracefully, e.g., show a toast notification\n    }\n  };\n\n  useEffect(() => {\n    let element = document.getElementById('drag-portal');\n    if (!element) {\n      element = document.createElement('div');\n      element.id = 'drag-portal';\n      document.body.appendChild(element);\n    }\n    const animationFrame = requestAnimationFrame(() => {\n      setPortalNode(element);\n      setMounted(true);\n    });\n    return () => cancelAnimationFrame(animationFrame);\n  }, []);\n\n  const handleDragEnd = async (result: DropResult) => {\n    console.log('handleDragEnd result:', result);\n\n    // If no destination, or dropped outside any droppable, delete the item\n    if (!result.destination) {\n      console.log('Dropped outside any droppable. Deleting item:', result.draggableId);\n      handleDeleteGift(result.draggableId);\n      setIsDragging(false); // End dragging state here if deleted\n      setSourceDroppableId(null); // Clear source droppable ID\n      return;\n    }\n\n    // Check if dropped into a trash bin\n    if (result.destination.droppableId === 'trash-bin-global') {\n      console.log('Dropped into trash bin:', result.destination.droppableId);\n      handleDeleteGift(result.draggableId);\n      setIsDragging(false); // End dragging state here if deleted\n      setSourceDroppableId(null); // Clear source droppable ID\n      return;\n    }\n\n    console.log('Dropped into a valid droppable (not trash bin):', result.destination.droppableId);\n\n    const sourceMemberIndex = family.members.findIndex(m => m.id === result.source.droppableId)\n    const destinationMemberIndex = family.members.findIndex(m => m.id === result.destination?.droppableId)\n\n    if (sourceMemberIndex === -1 || destinationMemberIndex === -1) {\n      console.error('Source or destination member not found.');\n      setIsDragging(false); // End dragging state if members not found\n      return;\n    }\n\n    const newFamily = { ...family }\n    const sourceMember = { ...newFamily.members[sourceMemberIndex] }\n    const destinationMember = { ...newFamily.members[destinationMemberIndex] }\n\n    // If dropped in the same list and same position, do nothing\n    if (result.source.droppableId === result.destination.droppableId && result.source.index === result.destination.index) {\n      setIsDragging(false); // End dragging state if no change\n      return;\n    }\n\n    const [removed] = sourceMember.gifts.splice(result.source.index, 1)\n    destinationMember.gifts.splice(result.destination.index, 0, removed)\n\n    // Re-index gifts in both source and destination members\n    sourceMember.gifts = sourceMember.gifts.map((gift, index) => ({ ...gift, order_index: index }));\n    destinationMember.gifts = destinationMember.gifts.map((gift, index) => ({ ...gift, order_index: index }));\n\n    // Optimistically update UI\n    newFamily.members[sourceMemberIndex] = sourceMember\n    newFamily.members[destinationMemberIndex] = destinationMember\n    setFamily(newFamily)\n\n    // Store the original family state for potential rollback\n    const originalFamily = family;\n\n    // Collect all gifts from the entire family structure that need their order_index updated\n    const giftsToUpdate = newFamily.members.flatMap(member =>\n      member.gifts.map(gift => ({\n        id: gift.id,\n        order_index: gift.order_index,\n        list_id: family.id, // Include list_id\n      }))\n    );\n\n    // Call API to update order\n    const res = await fetch('/api/gifts/reorder', {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ items: giftsToUpdate }),\n    })\n\n    if (!res.ok) {\n      const errorText = await res.text()\n      alert(`Failed to reorder gifts: ${errorText}`)\n      // Revert UI on API failure\n      setFamily(originalFamily);\n    } else {\n      refreshFamily(); // Refresh the page to ensure server-side state is consistent\n    }\n    setIsDragging(false); // End dragging after all logic is complete\n  }\n\n  const handleCopyInviteLink = async () => {\n    const inviteUrl = `${window.location.origin}/invite?token=${inviteToken}`;\n    try {\n      await navigator.clipboard.writeText(inviteUrl);\n      setCopyMessage('Copied!');\n      setTimeout(() => setCopyMessage(''), 2000); // Clear message after 2 seconds\n    } catch (err) {\n      console.error('Failed to copy: ', err);\n      setCopyMessage('Failed to copy!');\n    }\n  };\n\n  const handleFindMissingImages = async () => {\n    if (!user || user.id !== family.owner_id) {\n      alert('Only the list owner can find missing images.');\n      return;\n    }\n\n    setIsFindingImages(true);\n    setFindImagesMessage('Searching for missing images...');\n\n    const giftsToUpdate: Gift[] = [];\n\n    for (const member of family.members) {\n      for (const gift of member.gifts) {\n        if (!gift.product_image_url && gift.description) {\n          setFindImagesMessage(`Searching for image for \"${gift.description}\"...`);\n          try {\n            const scrapeRes = await fetch(`/api/scrape-pricespy?query=${gift.description}`);\n            const scrapeData = await scrapeRes.json();\n\n            if (scrapeRes.ok && scrapeData.imageUrl) {\n              setFindImagesMessage(`Found image for \"${gift. description}\". Updating...`);\n              const updateRes = await fetch('/api/gifts/update-image', {\n                method: 'PATCH',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ giftId: gift.id, imageUrl: scrapeData.imageUrl }),\n              });\n\n              if (updateRes.ok) {\n                giftsToUpdate.push({ ...gift, product_image_url: scrapeData.imageUrl });\n              } else {\n                const errorText = await updateRes.text();\n                console.error(`Failed to update image for ${gift.description}: ${errorText}`);\n                setFindImagesMessage(`Failed to update image for \"${gift.description}\".`);\n              }\n            } else {\n              console.log(`No image found for \"${gift.description}\" or scraping failed: ${scrapeData.message || scrapeData.error}`);\n              setFindImagesMessage(`No image found for \"${gift.description}\".`);\n            }\n          } catch (error) {\n            console.error(`Error processing ${gift.description}:`, error);\n            setFindImagesMessage(`Error processing \"${gift.description}\".`);\n          }\n        }\n      }\n    }\n\n    // Optimistically update the UI with found images\n    if (giftsToUpdate.length > 0) {\n      const newFamily = { ...family };\n      newFamily.members = newFamily.members.map(member => ({\n        ...member,\n        gifts: member.gifts.map(gift => {\n          const updatedGift = giftsToUpdate.find(g => g.id === gift.id);\n          return updatedGift || gift;\n        })\n      }));\n      setFamily(newFamily);\n    }\n\n    setFindImagesMessage('Finished searching for missing images.');\n    setIsFindingImages(false);\n    refreshFamily(); // Refresh to ensure server state is fully consistent\n  };\n\n  const handleDeleteGift = async (giftId: string) => {\n    console.log('Attempting to delete gift:', giftId);\n\n    // Add ownership check here\n    if (!user || user.id !== family.owner_id) {\n      alert('You do not have permission to delete gifts from this list.');\n      return;\n    }\n\n    const res = await fetch(`/api/gifts/${giftId}`, {\n      method: 'DELETE',\n    })\n\n    if (res.ok) {\n      console.log('Gift deleted successfully from API:', giftId);\n      // Update local state to remove the deleted gift\n      const newFamily = { ...family };\n      newFamily.members = newFamily.members.map(member => ({\n        ...member,\n        gifts: member.gifts.filter(gift => gift.id !== giftId)\n      }));\n      setFamily(newFamily);\n      console.log('Local state updated for gift:', giftId);\n      refreshFamily(); // Refresh data after successful deletion\n    } else {\n      const errorText = await res.text()\n      console.error('Failed to delete gift from API:', giftId, errorText);\n      alert(`Failed to delete gift: ${errorText}`)\n    }\n  }\n\n  const handleSort = (key: keyof Gift | 'order_index') => {\n    if (sortKey === key) {\n      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortKey(key);\n      setSortOrder('asc');\n    }\n  };\n\n  const handleRemoveMember = async (memberId: string) => {\n    if (!confirm('Are you sure you want to remove this member? This will delete all of their gifts from the list.')) return\n\n    console.log(`Removing member ${memberId} from family ${family.id}`)\n\n    const res = await fetch(`/api/lists/${family.id}/members/${memberId}`, {\n      method: 'DELETE',\n    })\n\n    if (res.ok) {\n      // Update local state to remove the member and their gifts\n      const newFamily = { ...family };\n      newFamily.members = newFamily.members.filter(member => member.id !== memberId);\n      setFamily(newFamily);\n      refreshFamily(); // Refresh data after successful member removal\n    } else {\n      const errorText = await res.text()\n      alert(`Failed to remove member: ${errorText}`)\n    }\n  }\n\n  const generateInvite = async () => {\n    const res = await fetch(`/api/lists/${familyId}/invites`, {\n      method: 'POST',\n    })\n\n    if (res.ok) {\n      const { token } = await res.json()\n      setInviteToken(token)\n      setShowQrModal(true)\n    } else {\n      const { error } = await res.json()\n      alert(`Failed to generate invite link: ${error}`)\n    }\n  }\n\n  const handleLeaveFamily = async () => {\n    if (!confirm('Are you sure you want to leave this family list? You will lose access to all gifts and members.')) return\n\n    const res = await fetch(`/api/lists/${family.id}/leave`, {\n      method: 'DELETE',\n    })\n\n    if (res.ok) {\n      alert('You have successfully left the family list.')\n      router.push('/') // Redirect to home page\n    } else {\n      const errorText: unknown = await res.json()\n      alert(`Failed to leave family: ${typeof errorText === 'object' && errorText !== null && 'error' in errorText ? (errorText as { error: string }).error : 'Unknown error'}`)\n    }\n  }\n\n  const sortedGifts = (gifts: Gift[]) => {\n    return [...gifts].sort((a, b) => {\n      let valA: string | number;\n      let valB: string | number;\n\n      if (sortKey === 'order_index') {\n        valA = a.order_index || 0;\n        valB = b.order_index || 0;\n      } else if (sortKey === 'price') {\n        valA = a.price || 0;\n        valB = b.price || 0;\n      } else {\n        valA = a[sortKey]?.toString().toLowerCase() || '';\n        valB = b[sortKey]?.toString().toLowerCase() || '';\n      }\n\n      if (valA < valB) return sortOrder === 'asc' ? -1 : 1;\n      if (valA > valB) return sortOrder === 'asc' ? 1 : -1;\n      return 0;\n    });\n  };\n\n  return (\n    <div className=\"px-4 py-8 mx-auto fresh-gradient min-h-screen\">\n      <div className=\"max-w-screen-lg mx-auto\">\n        <h1 className=\"text-4xl font-bold mb-4\">{family.name} Christmas List</h1>\n        <Link href=\"/\" className=\"text-blue-500 hover:underline mb-4 block\"> Back to Home</Link>\n\n        {/* Action Buttons */}\n        <div className=\"flex justify-end space-x-4 mb-4\">\n          {user && (\n            <button\n              onClick={() => setShowAddGiftModal(true)}\n              className=\"flex flex-col items-center p-2 rounded-lg hover:bg-gray-200 transition-colors\"\n              aria-label=\"Add Gift\"\n            >\n              <Image src=\"/gift.svg\" alt=\"Add Gift\" width={24} height={24} />\n              <span className=\"text-xs mt-1 dark:hover:text-black\">Add Gift</span>\n            </button>\n          )}\n          {user && user.id === family.owner_id && (\n            <button\n              onClick={() => setShowAddMemberModal(true)}\n              className=\"flex flex-col items-center p-2 rounded-lg hover:bg-gray-200 transition-colors\"\n              aria-label=\"Add Member\"\n            >\n              <Image src=\"/add-user.svg\" alt=\"Add Member\" width={24} height={24} />\n              <span className=\"text-xs mt-1 dark:hover:text-black\">Add Member</span>\n            </button>\n          )}\n          <button\n            onClick={generateInvite}\n            className=\"flex flex-col items-center p-2 rounded-lg hover:bg-gray-200 transition-colors\"\n            aria-label=\"Invite with QR Code\"\n          >\n            <Image src=\"/qr_code.svg\" alt=\"QR Code\" width={24} height={24} />\n            <span className=\"text-xs mt-1 dark:hover:text-black\">Invite</span>\n          </button>\n          {user && user.id === family.owner_id && ( // Only list owner can trigger this\n            <button\n              onClick={handleFindMissingImages}\n              className=\"flex flex-col items-center p-2 rounded-lg hover:bg-gray-200 transition-colors\"\n              aria-label=\"Find Missing Images\"\n              disabled={isFindingImages}\n            >\n              <Image src=\"/file.svg\" alt=\"Find Missing Images\" width={24} height={24} /> {/* Using file.svg as a placeholder */}\n              <span className=\"text-xs mt-1 dark:hover:text-black\">{isFindingImages ? 'Finding...' : 'Find Images'}</span>\n            </button>\n          )}\n          <Link href=\"/onboarding\"\n            className=\"flex flex-col items-center p-2 rounded-lg hover:bg-gray-200 transition-colors\"\n            aria-label=\"Help and Onboarding\"\n          >\n            <Image src=\"/question.svg\" alt=\"Help\" width={24} height={24} />\n            <span className=\"text-xs mt-1 dark:hover:text-black\">Help</span>\n          </Link>\n        </div>\n\n        {isFindingImages && findImagesMessage && (\n          <p className=\"text-center text-sm text-blue-500 mb-4\">{findImagesMessage}</p>\n        )}\n\n        <div className=\"mb-4 flex items-center space-x-2\">\n          <span className=\"text-gray-300\">Sort by:</span>\n          <select\n            className=\"px-3 py-1 border border-gray-300 rounded-md text-sm\"\n            value={sortKey}\n            onChange={(e) => handleSort(e.target.value as keyof Gift | 'order_index')}\n          >\n            <option value=\"order_index\">Default Order</option>\n            <option value=\"description\">Description</option>\n            <option value=\"price\">Price</option>\n          </select>\n          <button\n            onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')}\n            className=\"px-3 py-1 bg-gray-200 rounded-md text-sm\"\n          >\n            {sortOrder === 'asc' ? 'Asc' : 'Desc'}\n          </button>\n          <div className=\"ml-auto flex space-x-2\">\n            <button\n              onClick={() => setViewMode('list')}\n              className={`px-3 py-1 rounded-md text-sm ${viewMode === 'list' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}\n            >\n               List\n            </button>\n            <button\n              onClick={() => setViewMode('grid')}\n              className={`px-3 py-1 rounded-md text-sm ${viewMode === 'grid' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}\n            >\n               Grid\n            </button>\n          </div>\n        </div>\n\n        <DragDropContext\n          onBeforeDragStart={(start) => {\n            setIsDragging(true);\n            setSourceDroppableId(start.source.droppableId); // Set the ID of the list the item is dragged from\n          }}\n          onDragEnd={handleDragEnd}\n        >\n          {family.members.map((member) => (\n            <div key={member.id} className=\"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-8\">\n              <div className=\"flex justify-between items-center\">\n                <h2 className=\"text-2xl font-semibold mb-4\">{member.name}&#39;s List</h2>\n                {user && user.id === family.owner_id && user.id !== member.id && (\n                  <button\n                    onClick={() => handleRemoveMember(member.id)}\n                    className=\"px-2 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 text-xs\"\n                  >\n                    Remove\n                  </button>\n                )}\n              </div>\n              {member.gifts.length === 0 ? (\n                <p>No gifts on {member.name}&#39;s list yet.</p>\n              ) : (\n                <Droppable droppableId={member.id} isDropDisabled={isDragging && sourceDroppableId !== member.id}>\n                  {(provided) => (\n                    <ul\n                      className={`relative ${viewMode === 'grid' ? 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4' : 'list-disc pl-5 space-y-2'}`}\n                      {...provided.droppableProps}\n                      ref={provided.innerRef}\n                    >\n                      {sortedGifts(member.gifts).map((gift, index) => (\n                        <Draggable key={gift.id} draggableId={gift.id} index={index}>\n                          {(provided) => (\n                            <li\n                              ref={provided.innerRef}\n                              {...provided.draggableProps}\n                              {...provided.dragHandleProps} // Apply dragHandleProps here\n                              onDoubleClick={() => {\n                                if (user && user.id === gift.user_id) {\n                                  setEditingGift(gift);\n                                }\n                              }}\n                              className={`bg-gray-50 dark:bg-gray-700 rounded-md shadow-sm ${viewMode === 'grid' ? 'relative aspect-square overflow-hidden flex flex-col justify-between' : 'flex flex-col items-center sm:flex-row sm:items-center sm:justify-between p-2'}`}\n                            >\n                              {viewMode === 'grid' ? (\n                                <>\n                                  {gift.product_image_url && (\n                                    // eslint-disable-next-line @next/next/no-img-element\n                                    <img src={gift.product_image_url} alt={gift.product_title || gift.description} className=\"w-full h-2/3 object-cover\" />\n                                  )}\n                                  <div className=\"p-2 flex-grow flex flex-col justify-between\">\n                                    <div className=\"flex items-baseline\"> {/* Use flex to put description and claimed by on same line */}\n                                      <span className=\"text-sm font-semibold break-words\">\n                                        {gift.description}\n                                      </span>\n                                      {gift.is_purchased && user?.id !== gift.user_id && (\n                                        <span className=\"ml-2 text-xs text-green-600 flex-shrink-0\"> {/* Add ml-2 for spacing and flex-shrink-0 to prevent wrapping too early */}\n                                          (Claimed by {family.members.find(m => m.id === gift.purchased_by)?.name})\n                                        </span>\n                                      )}\n                                    </div>\n                                  </div>\n                                  {gift.price !== undefined && gift.price !== null && (\n                                    <div className=\"absolute bottom-2 left-2 text-sm font-semibold text-gray-700 dark:text-gray-300\">\n                                      ${gift.price.toFixed(2)}\n                                    </div>\n                                  )}\n                                  <div className=\"absolute bottom-2 right-2 flex flex-col sm:flex-row sm:space-x-1 space-y-1\">\n                                    {gift.product_url && (\n                                      <a\n                                        href={gift.product_url}\n                                        target=\"_blank\"\n                                        rel=\"noopener noreferrer\"\n                                        className=\"p-2 text-blue-500 rounded-full hover:bg-blue-100 transition-colors flex items-center justify-center\"\n                                        onClick={(e) => e.stopPropagation()}\n                                        aria-label=\"Open Link\"\n                                      >\n                                        <Image src=\"/link.svg\" alt=\"Open Link\" width={20} height={20} />\n                                      </a>\n                                    )}\n                                    {user && user.id !== gift.user_id && (\n                                      <ClaimUnclaimButtons\n                                        gift={gift}\n                                        userId={user.id}\n                                        refreshFamily={refreshFamily}\n                                      />\n                                    )}\n                                  </div>\n                                </>\n                              ) : (\n                                <>\n                                  <div className=\"flex w-full p-2\"> {/* Main container for image + text/price + buttons */}\n                                    {gift.product_image_url && (\n                                      // Image on the left\n                                      // eslint-disable-next-line @next/next/no-img-element\n                                      <img src={gift.product_image_url} alt={gift.product_title || gift.description} className=\"w-24 h-24 object-cover rounded-md mr-3 flex-shrink-0\" />\n                                    )}\n\n                                    <div className=\"flex-grow flex flex-col justify-between\"> {/* Container for description, claimed by, and price */}\n                                      <div> {/* Description and claimed by */}\n                                        <span className=\"font-semibold break-words\">\n                                          {gift.description}\n                                        </span>\n                                        {gift.is_purchased && user?.id !== gift.user_id && (\n                                          <span className=\"ml-2 text-sm text-green-600\">\n                                            (Claimed by {family.members.find(m => m.id === gift.purchased_by)?.name})\n                                          </span>\n                                        )}\n                                      </div>\n                                      {gift.price !== undefined && gift.price !== null && (\n                                        <div className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mt-1\">\n                                          ${gift.price.toFixed(2)}\n                                        </div>\n                                      )}\n                                    </div>\n\n                                    <div className=\"flex-shrink-0 flex flex-col justify-end items-end ml-auto\"> {/* Buttons container */}\n                                      {gift.product_url && (\n                                        <a\n                                          href={gift.product_url}\n                                          target=\"_blank\"\n                                          rel=\"noopener noreferrer\"\n                                          className=\"p-2 text-blue-500 rounded-full hover:bg-blue-100 transition-colors flex items-center justify-center\"\n                                          onClick={(e) => e.stopPropagation()}\n                                          aria-label=\"Open Link\"\n                                        >\n                                          <Image src=\"/link.svg\" alt=\"Open Link\" width={24} height={24} />\n                                        </a>\n                                      )}\n                                      {user && user.id !== gift.user_id && (\n                                        <ClaimUnclaimButtons\n                                        gift={gift}\n                                        userId={user.id}\n                                        refreshFamily={refreshFamily}\n                                      />\n                                      )}\n                                    </div>\n                                  </div>\n                                </>\n                              )}\n                            </li>\n                          )}\n                        </Draggable>\n                      ))}\n                      {provided.placeholder}\n                    </ul>\n                  )}\n                </Droppable>\n              )}\n            </div>\n          ))}\n\n          {mounted && portalNode && ReactDOM.createPortal(\n            <Droppable droppableId=\"trash-bin-global\">\n              {(provided) => (\n                <div\n                  ref={provided.innerRef}\n                  {...provided.droppableProps}\n                  className={`fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-md p-4 border-2 border-dashed rounded-lg text-center transition-all duration-200 z-50\n                    border-red-500 bg-red-50 dark:bg-red-900 text-red-500 dark:text-red-200\n                    ${isDragging ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}\n                >\n                  Drag here to delete gift \n                  {provided.placeholder}\n                </div>\n              )}\n            </Droppable>,\n            portalNode\n          )}\n        </DragDropContext>\n\n        {/* Modals */}\n        {showAddGiftModal && user && (\n          <AddGiftForm\n            familyId={family.id}\n            currentUserId={user.id}\n            members={family.members}\n            onClose={() => setShowAddGiftModal(false)} // Pass onClose prop\n            onGiftAdded={refreshFamily} // Pass refreshFamily to AddGiftForm\n          />\n        )}\n\n        {showAddMemberModal && user && user.id === family.owner_id && (\n          <AddMemberForm\n            familyId={family.id}\n            currentUserId={user.id}\n            members={family.members}\n            onClose={() => setShowAddMemberModal(false)} // Pass onClose prop\n            onMemberAdded={refreshFamily} // Pass refreshFamily to AddMemberForm\n          />\n        )}\n\n        {user && user.id !== family.owner_id && (\n          <div className=\"mt-4\">\n            <button\n              onClick={handleLeaveFamily}\n              className=\"w-full bg-red-500 text-white py-2 px-4 rounded-md hover:bg-red-600\"\n            >\n              Leave Family List\n            </button>\n          </div>\n        )}\n\n        {editingGift && (\n          <EditGiftForm\n            gift={editingGift}\n            onClose={() => setEditingGift(null)}\n            onSave={async () => { // Make the onSave callback async\n              setEditingGift(null)\n              await refreshFamily() // Call refreshFamily after saving an edited gift\n            }}\n          />\n        )}\n\n        {showQrModal && inviteToken && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n            <div className=\"bg-white p-8 rounded-lg shadow-lg text-center\">\n              <h2 className=\"text-2xl font-bold mb-4\">Scan to Join!</h2>\n              <QRCode value={`${window.location.origin}/invite?token=${inviteToken}`} />\n              {copyMessage && <p className=\"text-green-500 mt-2\">{copyMessage}</p>}\n              <div className=\"mt-4 flex justify-center space-x-2\">\n                <button\n                  onClick={handleCopyInviteLink}\n                  className=\"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600\"\n                >\n                  Copy Invite Link\n                </button>\n                <button\n                  onClick={() => setShowQrModal(false)}\n                  className=\"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600\"\n                >\n                  Close\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\n"],"names":[],"mappings":"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","debugId":null}}]
}